// Simple in-memory storage (will reset on reload)
const users = {
    "devs": { password: "2004", passwords: {} }
}; // Default user for testing
let currentUser = null;

function showElement(id) {
    document.getElementById(id).classList.remove('hidden');
}

function hideElement(id) {
    document.getElementById(id).classList.add('hidden');
}

function showSignUp() {
    hideElement('homepage');
    showElement('signup-form');
}

function showSignIn() {
    hideElement('homepage');
    showElement('signin-form');
}

function signUp() {
    const username = document.getElementById('new-username').value.trim();
    const password = document.getElementById('new-password').value;
    if (username && password) {
        if (users[username]) {
            displayOutput("Username already exists. Please choose a different one.");
        } else {
            users[username] = { password, passwords: {} };
            displayOutput(`Sign-up successful for ${username}!`);
            goToHomepage();
        }
    } else {
        displayOutput("Please enter both username and password.");
    }
}

function signIn() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    if (users[username] && users[username].password === password) {
        currentUser = username;
        displayOutput(`Welcome, ${username}!`);
        showUserPage();
    } else {
        displayOutput("Invalid credentials!");
    }
}

function showUserPage() {
    hideElement('signin-form');
    showElement('user-page');
}

function showNewPassword() {
    hideElement('user-page');
    showElement('new-password-section');
}

function showFindPassword() {
    hideElement('user-page');
    showElement('find-password-section');
}

function showEditPassword() {
    hideElement('user-page');
    showElement('edit-password-section');
}

function showDeletePassword() {
    hideElement('user-page');
    showElement('delete-password-section');
}

function goToUserPage() {
    ['new-password-section', 'find-password-section', 'edit-password-section', 'delete-password-section'].forEach(hideElement);
    showElement('user-page');
}

function saveNewPassword() {
    const name = document.getElementById('password-name').value.trim();
    const password = document.getElementById('password-value').value;
    if (name && password) {
        users[currentUser].passwords[name] = password;
        displayOutput(`Password saved for ${name}!`);
        goToUserPage();
    } else {
        displayOutput("Please enter both name and password.");
    }
}

function findPassword() {
    const name = document.getElementById('find-password-name').value.trim();
    const password = users[currentUser].passwords[name];
    if (password) {
        displayOutput(`Password for <strong>${name}:</strong> ${password}`);
    } else {
        displayOutput("Name not found.");
    }
}

function showAllPasswords() {
    const passwords = users[currentUser].passwords;
    if (Object.keys(passwords).length === 0) {
        displayOutput("You haven't saved any passwords yet.");
    } else {
        let output = "<strong>Your saved passwords:</strong><br>";
        for (const [name, password] of Object.entries(passwords)) {
            output += `<strong>${name}:</strong> ${password}<br>`;
        }
        displayOutput(output);
    }
}

function editPassword() {
    const name = document.getElementById('edit-password-name').value.trim();
    const newPassword = document.getElementById('edit-password-value').value;
    if (users[currentUser].passwords[name]) {
        users[currentUser].passwords[name] = newPassword;
        displayOutput(`Password updated for ${name}!`);
        goToUserPage();
    } else {
        displayOutput("Name not found.");
    }
}

function deletePassword() {
    const name = document.getElementById('delete-password-name').value.trim();
    if (users[currentUser].passwords[name]) {
        delete users[currentUser].passwords[name];
        displayOutput(`Password deleted for ${name}!`);
    } else {
        displayOutput("Name not found.");
    }
}

function goToHomepage() {
    ['signup-form', 'signin-form', 'user-page'].forEach(hideElement);
    showElement('homepage');
    currentUser = null; // Log the user out
    displayOutput(""); // Clear output on return to homepage
}

function displayOutput(message) {
    document.getElementById('output-box').innerHTML = message;
}

// Add event listeners for buttons
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('show-signup-btn').addEventListener('click', showSignUp);
    document.getElementById('show-signin-btn').addEventListener('click', showSignIn);
    document.getElementById('signup-btn').addEventListener('click', signUp);
    document.getElementById('signin-btn').addEventListener('click', signIn);
    document.getElementById('show-new-password-btn').addEventListener('click', showNewPassword);
    document.getElementById('show-find-password-btn').addEventListener('click', showFindPassword);
    document.getElementById('show-edit-password-btn').addEventListener('click', showEditPassword);
    document.getElementById('show-delete-password-btn').addEventListener('click', showDeletePassword);
    document.getElementById('save-new-password-btn').addEventListener('click', saveNewPassword);
    document.getElementById('find-password-btn').addEventListener('click', findPassword);
    document.getElementById('show-all-passwords-btn').addEventListener('click', showAllPasswords);
    document.getElementById('edit-password-btn').addEventListener('click', editPassword);
    document.getElementById('delete-password-btn').addEventListener('click', deletePassword);
    document.querySelectorAll('.go-home-btn').forEach(button => button.addEventListener('click', goToHomepage));
    document.querySelectorAll('.go-user-page-btn').forEach(button => button.addEventListener('click', goToUserPage));
});
